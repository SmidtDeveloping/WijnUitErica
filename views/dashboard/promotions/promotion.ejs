<!DOCTYPE html>
<html>

<head>
  <title>Actiebeheer</title>
  <link href="https://fonts.gstatic.com" rel="preconnect">
  <link
    href="https://fonts.googleapis.com/css?family=Open+Sans:300,400,600,700|Nunito:300,400,600,700|Poppins:300,400,500,600,700"
    rel="stylesheet">

  <link href="/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
  <link href="/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
  <link href="/css/style.css" rel="stylesheet">
</head>

<body>
  <%- include('../../partials/dashboardHeader') %>
    <%- include('../../partials/dashboardNav') %>

      <main class="main" id="main">
        <div class="pagetitle">
          <h1>Actiebeheer</h1>
          <nav>
            <ol class="breadcrumb">
              <li class="breadcrumb-item"><a href="/">Home</a></li>
              <li class="breadcrumb-item"><a href="/dashboard">Dashboard</a></li>
              <li class="breadcrumb-item active">Actiebeheer</li>
            </ol>
          </nav>
        </div>

        <section class="section dashboard">
          <div class="card mb-4 shadow-sm">
            <div class="card-header">
              <strong>Nieuwe Actie toevoegen</strong>
            </div>
            <br>
            <div class="card-body">
              <form method="POST" action="/dashboard/promotions">
                <div class="row g-2">
                  <div class="col-md"><input name="name" class="form-control" placeholder="Naam (bv. 1+1 Witte Wijn)"
                      required></div>
                  <div class="col-md">
                    <select name="type" class="form-select" required>
                      <option value="percentage">Percentage (%)</option>
                      <option value="fixed">Vaste korting (€)</option>
                      <option value="fixed_price">Vaste prijs (€)</option>
                      <option value="buy_x_get_y">Koop X, krijg Y</option>
                    </select>
                  </div>
                  <div class="col-md"><input type="number" name="value" class="form-control" placeholder="Waarde"></div>
                  <div class="col-md"><input type="number" name="buyQuantity" class="form-control" placeholder="Buy X">
                  </div>
                  <div class="col-md"><input type="number" name="getQuantity" class="form-control" placeholder="Get Y">
                  </div>
                  <div class="col-md"><input type="date" name="validUntil" class="form-control"></div>
                </div>

                <div class="mt-3">
                  <label class="form-label">Koppel producten:</label>
                  <select name="productIds" class="form-select" multiple size="5">
                    <% products.forEach(prod=> { %>
                      <option value="<%= prod._id %>">
                        <%= prod.naam %> (€<%= prod.prijs %>)
                      </option>
                      <% }) %>
                  </select>
                </div>

                <button type="submit" class="btn btn-primary mt-3">
                  <i class="bi bi-plus-circle"></i> Toevoegen
                </button>
              </form>
            </div>
          </div>

          <div class="card shadow-sm">
            <div class="card-header">
              <strong>Huidige acties</strong>
            </div>
            <br>
            <div class="card-body">
              <table class="table table-bordered align-middle">
                <thead class="table-light">
                  <tr>
                    <th>Naam</th>
                    <th>Type</th>
                    <th>Waarde</th>
                    <th>X</th>
                    <th>Y</th>
                    <th>Producten</th>
                    <th>Tot</th>
                    <th>Status</th>
                    <th>Acties</th>
                  </tr>
                </thead>
                <tbody>
                  <% promotions.forEach(promo=> { %>
                    <tr>
                      <td>
                        <%= promo.name %>
                      </td>
                      <td>
                        <%= promo.type %>
                      </td>
                      <td>
                        <%= promo.value || 'NVT' %>
                      </td>
                      <td>
                        <%= promo.buyQuantity || 'NVT' %>
                      </td>
                      <td>
                        <%= promo.getQuantity || 'NVT' %>
                      </td>
                      <td>
                        <% if (promo.productIds.length> 0) { %>
                          <ul class="mb-0">
                            <% promo.productIds.forEach(p=> { %>
                              <li>
                                <%= p.naam %>
                              </li>
                              <% }) %>
                          </ul>
                          <% } else { %>
                            <span class="text-muted">Geen</span>
                            <% } %>
                      </td>
                      <td>
                        <%= promo.validUntil ? promo.validUntil.toLocaleDateString() : '-' %>
                      </td>
                      <td>
                        <% if (promo.active) { %>
                          <span class="badge bg-success">Actief</span>
                          <% } else { %>
                            <span class="badge bg-secondary">Uit</span>
                            <% } %>
                      </td>
                      <td>
                        <div class="d-flex gap-2">
                          <form method="POST" action="/dashboard/promotions/<%= promo._id %>/toggle">
                            <button class="btn btn-sm <%= promo.active ? 'btn-warning' : 'btn-success' %>">
                              <%= promo.active ? 'Uitzetten' : 'Aanzetten' %>
                            </button>
                          </form>
                          <form method="POST" action="/dashboard/promotions/<%= promo._id %>/delete">
                            <button class="btn btn-sm btn-danger">
                              <i class="bi bi-trash"></i> Verwijderen
                            </button>
                          </form>
                        </div>
                      </td>
                    </tr>
                    <% }) %>
                </tbody>
              </table>
            </div>
          </div>
        </section>
      </main>
</body>

</html>